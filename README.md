# Тема «Промышленность».<br>Финальный проект.
  * [Описание исследования](#Описание-исследования)
  * [Описание данных](#Описание-данных)
  * [Общий вывод](#Общий-вывод)
  * [Отчёт](#Отчёт)
## Описание исследования
Чтобы оптимизировать производственные расходы,  
металлургический комбинат ООО «Так закаляем сталь» решил уменьшить потребление электроэнергии на этапе обработки стали.  
Предстоит построить модель, которая предскажет температуру стали.  
Задача регрессионная: нужно предсказать количественный показатель.

<b>Описание этапа обработки</b>  
Сталь обрабатывают в металлическом ковше вместимостью около 100 тонн.  
Чтобы ковш выдерживал высокие температуры, изнутри его облицовывают огнеупорным кирпичом.  
Расплавленную сталь заливают в ковш и подогревают до нужной температуры графитовыми электродами. Они установлены в крышке ковша.  

Из сплава выводится сера (десульфурация), добавлением примесей корректируется химический состав и отбираются пробы.  
Сталь легируют — изменяют её состав — подавая куски сплава из бункера для сыпучих материалов или проволоку через специальный трайб-аппарат (англ. tribe, «масса»).  
Перед тем как первый раз ввести легирующие добавки, измеряют температуру стали и производят её химический анализ.  
Потом температуру на несколько минут повышают, добавляют легирующие материалы и продувают сплав инертным газом.  
Затем его перемешивают и снова проводят измерения.  
Такой цикл повторяется до достижения целевого химического состава и оптимальной температуры плавки.  
Тогда расплавленная сталь отправляется на доводку металла или поступает в машину непрерывной разливки.  
Оттуда готовый продукт выходит в виде заготовок-слябов (англ. slab, «плита»).  
## Описание данных
Данные состоят из файлов, полученных из разных источников:  
`data_arc.csv` — данные об электродах;  
`data_bulk.csv` — данные о подаче сыпучих материалов (объём);  
`data_bulk_time.csv` — данные о подаче сыпучих материалов (время);  
`data_gas.csv` — данные о продувке сплава газом;  
`data_temp.csv` — результаты измерения температуры;  
`data_wire.csv` — данные о проволочных материалах (объём);  
`data_wire_time.csv` — данные о проволочных материалах (время).  
Во всех файлах столбец `key` содержит номер партии.  
В файлах может быть несколько строк с одинаковым значением `key`:  
они соответствуют разным итерациям обработки.  

<b>Целевой признак</b>  
Конечная «Температура» файла `data_temp.csv`.
## Общий вывод
- Привёл названия столбцов к стандартному виду.  
- Обработал пропуски и выбросы.  
- Убрал признаки, по которым было совсем незначительное количество данных по партиям.
- Выявил закономерность, по которой ограничены данные целевого признака для партий, начиная с номера 2500.  
    Так как это целевой признак, будут проблемы с целевым показателем MAE, убрал данные по проблемным партиям.
- Добавил дополнительные признаки там, где это показалось уместным.
- Подготовил финальные таблицы для объединения в общую таблицу для обучения моделей.
- По прошлому опыту решил проверить четыре модели: Линейная регрессия, «Случайный лес», CatBoostRegressor, LGBMRegressor.
- Лучший целевой показатель на тренировочных данных (MAE 3.24) показала модель CatBoostRegressor.
- После фильтрации признаков по соотношению важность / корелляция целевой показатель (MAE) на тестовых данных получился 5.5.  
    То есть модель ошибается на ≈ 5,5 градуса.
- Самые важные показатели: `first_temp`, `apparent_power`, `time_temp_diff`, `wire_1`.
- Получившийся результат проходит по условиям задачи MAE ≤ 6.0 (6 sp).  
    Допускаю, что можно улучшить результат за счёт лучшего подбора параметров, обработки выбросов.  
    Может быть имеет смысл попробовать ещё какие-то модели.<br><br>
## Отчёт
- Для теста взял четыре модели, знакомые по прошлому обучению: Линейная регрессия, «Случайный лес», CatBoostRegressor, LGBMRegressor.
- Основные параметры, которые подбирались: глубина «дерева» (depth), скорость обучения (learning_rate), максимальное количество «деревьев» (n_estimators).
- Целевая метрика — средняя абсолютная ошибка (MAE) рассчитывается как сумма абсолютных ошибок, делённая на размер выборки.  
    Лучший показатель получился у модели CatBoostRegressor — 3.21 на тренировочных данных, 5.59 на тестовых и 5.5 после фильтрации признаков.
- При фильтрации признаков были убраны данные о проволочных материалах (время), о подаче сыпучих материалов (время).  
    Удалил признаки, которые не могут повлиять на обучение, данные о сыпучих и проволочных данных, использованные на крайне малом количестве партий.  
    На основе данных о корреляции признаков и важности признаков у финальной модели убрал признаки о количестве итераций нагрева (heating_rounds), реактивной мощности (reactive_power), времени нагрева электродами (arc_heating_time).  
    Из данных о важности признаков выделяется показатель начальной температуры, что логично говорит о том, что через влияние на начальную температуру можно влиять и на конечную.
- Признаки, которые попали в финальную таблицу:  
    apparent_power, real_power, bulk_12, bulk_14, bulk_15, gas_1, first_temp_ts, finish_temp_ts, first_temp, finish_temp, time_temp_diff, wire_1  
- По всем признакам привёл названия столбцов к стандартному виду, обработал пропуски и выбросы, убрал данные по проблемным партиям, у которых было мало данных по целевому признаку.
- Добавил дополнительные признаки там, где это показалось уместным.

<i>«Какие пункты плана были выполнены, а какие — нет (поясните почему)?»</i>  
    Все пункты плана удалось выполнить, сразу не удалось сообразить о том, что нужно будет проанализировать важность признаков итоговой модели и отфильтровать, исходя из параметров о корреляции признаков.

<i>«Какие трудности возникли и как вы их преодолели?»</i>  
    Было сложно разобраться в технологическом процессе и обилии, связи признаков во всех файлах.  
    Стало проще после консультации тимлида, финальные штрихи подсказали другие ребята в Slack.

<i>«Какие ключевые шаги в решении задачи выделили?»</i>  
- Разбор технологического процесса.
- Консультация с экспертом.
- Обсуждение проблемных моментов с другими студентами.
- Изучение и предобработка входных данных.
- Подбор моделей для тестирования;  
    выбор метрики (в нашем случае была задана Николаем);  
    подбор лучших параметров, исходя из метрики.

<i>«Какая ваша итоговая модель и какое у неё качество?»</i>  
    Итоговая модель — CatBoostRegressor.  
    Показатель MAE на тестовых данных — 5.5.

***
_Работа над проектом велась в PyCharm 2021.3.2 (Professional Edition)_<br>
_формат ячеек Markdown различается в веб-версии и в PyCharm_